---
#####
# ansible/group_vars/db_local.yml
# common variables and settings for all DB machines
#

####
#1. VM and libvirt section
####


# virtualisation switch, default libvirtd
target_virtualization: libvirt   # libvirt | vmware

# SSH keys to inject to VM installation (local users, normally in some key vault or kerberos/IPA/... infrastructure)
# ansible_master_pubkeys:
#  - "{{ lookup('file', '/home/ansible_master/.ssh/id_ed25519.pub') }}" # on localhost permissions problem obviously

ansible_master_pubkeys:
  - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBILiayOh8hknMLeYILupd3HetTQu116Sj03vY6FT7Ar ansible_master@thinkpad"
rocky_pubkeys:
  - "{{ lookup('file', lookup('env','HOME') + '/.ssh/id_rsa.pub') | default('') }}" # (user for first login if root not desired)

# Libvirt (qemu:///system) â€“ common
libvirt_pool_name: "libvirt-images"
libvirt_pool_path: "/home/{{ lookup('env','USER') }}/libvirt-images"
libvirt_network_name: "default"

#using this commented line bellow means You download it from public repo, that means a lot of waiting
# better use local mirror (file, ftp, http)
#image_url: "https://download.rockylinux.org/pub/rocky/9/images/x86_64/Rocky-9-GenericCloud.latest.x86_64.qcow2"
image_url: ""   # skip downloading
base_image_name: "Rocky-9-GenericCloud.latest.x86_64.qcow2"

graphics: "vnc" # or tty, but vnc means you have a visual console like vCenter :)
autoport: true
serial_console: true

# SSH wait
ssh_user: rocky
ssh_port: 22
ssh_wait_timeout: 420

###
### VMware varables (for vmware, TBD)
###

vcenter_hostname: "vcenter.example.local"
vcenter_username: "admin@vsphere.local"
vcenter_password: "{{ vault_vcenter_password | default('') }}"
validate_certs: false
vmw_datacenter: "DatacenterXYZ"
vmw_cluster: "ClusterXYZ"
vmw_datastore: "DatastoreXYZ"
vmw_folder: "/DBs"
vmw_network: "VM Network"
vmw_template: "rocky-9"
vmw_cpu: 2
vmw_memory_mb: 2048
vmw_additional_disk_gb: 2


####
#2. OS config - common attributes
####

os_config:
  # tuned
  tuned_profile: "virtual-guest"
  sysctl:
    vm.swappiness: 10
    vm.dirty_background_ratio: 5
    vm.dirty_ratio: 20

  # LVM layout variables
  lvm_device: "/dev/vdb"
  pv_size: 2
  vg_name: "vg_data"
  lv_data_name: "lv_data_psql"
  lv_wal_name: "lv_log_psql"
  fstype: "xfs"
  mnt_data: "/data"
  mnt_wal: "/pgwal"
  data_percent: 80
  wal_percent: 20

  # SELinux
  manage_selinux: true
  selinux_state: "disabled"

  # limits
  limits:
    nofile_soft: 102400
    nofile_hard: 1048576
    nproc_soft: 4096
    nproc_hard: 16384
    memlock_soft: unlimited
    memlock_hard: unlimited

